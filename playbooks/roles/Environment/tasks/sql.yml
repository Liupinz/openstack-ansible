- name: install sql
  yum: name={{item}} state=installed
  with_items:
      - mariadb
      - mariadb-server
      - python2-PyMySQL

- name: add mariadb_openstack.cnf file
  copy: src=files/openstack.cnf dest=/etc/my.cnf.d/

- name: install expect
  yum: name=expect state=installed

- name: copy file
  copy: src=files/mysql_secure_installation.exp dest=/root/

- name: chmod
  file: path=/root/mysql_secure_installation.exp mode=777

- name: start mariadb
  service: name=mariadb state=started enabled=yes

- name: expect the mysql_secure_installation.exp
  command: ./mysql_secure_installation.exp

- name: del mysql_secure_installation.exp
  file: path=/root/mysql_secure_installation.exp state=absent
